<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.*?>
<?import javafx.geometry.*?>
<?import com.jfoenix.controls.*?>
<?import org.kordamp.ikonli.javafx.*?>
<?import com.audioflow.component.*?>

<StackPane xmlns="http://javafx.com/javafx/21"
           xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="com.audioflow.controller.NowPlayingController"
           fx:id="rootPane"
           styleClass="now-playing-root"
           stylesheets="@../styles/now-playing.css">

    <!-- Fondo con gradiente -->
    <VBox fx:id="backgroundGradient" styleClass="background-gradient" />

    <!-- Contenido principal -->
    <VBox alignment="CENTER" spacing="20" styleClass="content-container">
        <padding>
            <Insets top="40" right="60" bottom="40" left="60"/>
        </padding>

        <!-- Botón para cerrar/volver -->
        <HBox alignment="TOP_RIGHT" VBox.vgrow="NEVER">
            <JFXButton fx:id="closeBtn" onAction="#handleClose" styleClass="close-btn">
                <graphic>
                    <FontIcon iconLiteral="fas-times" iconSize="20"/>
                </graphic>
            </JFXButton>
        </HBox>

        <!-- Área central con carátula y visualizador -->
        <VBox alignment="CENTER" spacing="30" VBox.vgrow="ALWAYS">
            
            <!-- Carátula del álbum -->
            <StackPane fx:id="albumArtContainer" styleClass="album-art-container">
                <ImageView fx:id="albumArtView" fitWidth="300" fitHeight="300" preserveRatio="true" styleClass="album-art"/>
                <!-- Placeholder cuando no hay imagen -->
                <VBox fx:id="albumPlaceholder" alignment="CENTER" spacing="10" styleClass="album-placeholder">
                    <FontIcon iconLiteral="fas-music" iconSize="80" styleClass="placeholder-icon"/>
                </VBox>
            </StackPane>

            <!-- Visualizador de audio (Canvas) -->
            <HBox alignment="CENTER">
                <AudioVisualizer fx:id="audioVisualizer" width="350" height="80"/>
            </HBox>

        </VBox>

        <!-- Información de la canción -->
        <VBox alignment="CENTER" spacing="8" styleClass="song-info">
            <Label fx:id="songTitleLabel" text="Sin canción" styleClass="song-title-large"/>
            <Label fx:id="artistLabel" text="Artista desconocido" styleClass="artist-name-large"/>
            
            <!-- Rating de estrellas -->
            <HBox alignment="CENTER" styleClass="rating-container">
                <padding>
                    <Insets top="10"/>
                </padding>
                <StarRating fx:id="starRating"/>
            </HBox>
        </VBox>

        <!-- Controles de reproducción -->
        <VBox alignment="CENTER" spacing="15" styleClass="player-controls">
            
            <!-- Barra de progreso -->
            <HBox alignment="CENTER" spacing="15" styleClass="progress-container">
                <Label fx:id="currentTimeLabel" text="0:00" styleClass="time-label"/>
                <JFXSlider fx:id="progressSlider" min="0" max="100" value="0" 
                           styleClass="progress-slider-large" HBox.hgrow="ALWAYS" maxWidth="400"/>
                <Label fx:id="totalTimeLabel" text="0:00" styleClass="time-label"/>
            </HBox>

            <!-- Botones de control -->
            <HBox alignment="CENTER" spacing="30" styleClass="controls-row">
                <!-- Shuffle -->
                <JFXButton fx:id="shuffleBtn" onAction="#handleShuffle" styleClass="control-btn-secondary">
                    <graphic>
                        <FontIcon fx:id="shuffleIcon" iconLiteral="fas-random" iconSize="18"/>
                    </graphic>
                </JFXButton>

                <!-- Previous -->
                <JFXButton fx:id="prevBtn" onAction="#handlePrevious" styleClass="control-btn">
                    <graphic>
                        <FontIcon iconLiteral="fas-step-backward" iconSize="24"/>
                    </graphic>
                </JFXButton>

                <!-- Play/Pause (grande) -->
                <JFXButton fx:id="playPauseBtn" onAction="#handlePlayPause" styleClass="play-btn-large">
                    <graphic>
                        <FontIcon fx:id="playPauseIcon" iconLiteral="fas-play" iconSize="32"/>
                    </graphic>
                </JFXButton>

                <!-- Next -->
                <JFXButton fx:id="nextBtn" onAction="#handleNext" styleClass="control-btn">
                    <graphic>
                        <FontIcon iconLiteral="fas-step-forward" iconSize="24"/>
                    </graphic>
                </JFXButton>

                <!-- Repeat -->
                <JFXButton fx:id="repeatBtn" onAction="#handleRepeat" styleClass="control-btn-secondary">
                    <graphic>
                        <FontIcon fx:id="repeatIcon" iconLiteral="fas-redo" iconSize="18"/>
                    </graphic>
                </JFXButton>
            </HBox>

            <!-- Control de volumen -->
            <HBox alignment="CENTER" spacing="10" styleClass="volume-control">
                <JFXButton onAction="#handleMute" styleClass="control-btn-mini">
                    <graphic>
                        <FontIcon fx:id="volumeIcon" iconLiteral="fas-volume-up" iconSize="16"/>
                    </graphic>
                </JFXButton>
                <JFXSlider fx:id="volumeSlider" min="0" max="100" value="70" 
                           styleClass="volume-slider" prefWidth="120"/>
            </HBox>

        </VBox>

    </VBox>

    <!-- Feedback visual (iconos translúcidos) -->
    <StackPane fx:id="feedbackOverlay" mouseTransparent="true" styleClass="feedback-overlay">
        <FontIcon fx:id="feedbackIcon" iconLiteral="fas-play" iconSize="100" styleClass="feedback-icon"/>
    </StackPane>

</StackPane>
